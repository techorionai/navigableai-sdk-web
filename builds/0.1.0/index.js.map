{"version":3,"file":"index.js","sources":["index.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nclass NavigableAI {\n    constructor(options) {\n        this.sharedSecretKeyConfig = undefined;\n        this.identifier = undefined;\n        this.setIdentifier = (identifier) => {\n            this.identifier = identifier;\n            this.localStorage.set(\"identifier\", identifier);\n        };\n        this.getIdentifierFromLocalStorage = () => {\n            const identifier = this.localStorage.get(\"identifier\");\n            if (identifier) {\n                this.identifier = identifier;\n            }\n        };\n        this.chatWindow = {\n            id: undefined,\n            messages: [],\n            defaults: {\n                error: \"An error occurred. Please try again later.\",\n                title: \"Assistant\",\n                logo: `<svg class=\"ai-chat-window-header-logo\" aria-hidden=\"true\"  xmlns=\"http://www.w3.org/2000/svg\"  width=\"24\"  height=\"24\"  viewBox=\"0 0 24 24\"  fill=\"none\"  stroke=\"currentColor\"  stroke-width=\"2\"  stroke-linecap=\"round\"  stroke-linejoin=\"round\"  class=\"icon icon-tabler icons-tabler-outline icon-tabler-sparkles\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16 18a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm0 -12a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm-7 12a6 6 0 0 1 6 -6a6 6 0 0 1 -6 -6a6 6 0 0 1 -6 6a6 6 0 0 1 6 6z\" /></svg>`,\n                closeIcon: `<svg class=\"ai-chat-window-header-close-icon\" xmlns=\"http://www.w3.org/2000/svg\"  width=\"24\"  height=\"24\"  viewBox=\"0 0 24 24\"  fill=\"none\"  stroke=\"currentColor\"  stroke-width=\"2\"  stroke-linecap=\"round\"  stroke-linejoin=\"round\"  class=\"icon icon-tabler icons-tabler-outline icon-tabler-x\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M18 6l-12 12\" /><path d=\"M6 6l12 12\" /></svg>`,\n                sendIcon: `<svg class=\"ai-chat-window-input-send-icon\" xmlns=\"http://www.w3.org/2000/svg\"  width=\"24\"  height=\"24\"  viewBox=\"0 0 24 24\"  fill=\"currentColor\"  class=\"icon icon-tabler icons-tabler-filled icon-tabler-circle-arrow-up\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-4.98 3.66l-.163 .01l-.086 .016l-.142 .045l-.113 .054l-.07 .043l-.095 .071l-.058 .054l-4 4l-.083 .094a1 1 0 0 0 1.497 1.32l2.293 -2.293v5.586l.007 .117a1 1 0 0 0 1.993 -.117v-5.585l2.293 2.292l.094 .083a1 1 0 0 0 1.32 -1.497l-4 -4l-.082 -.073l-.089 -.064l-.113 -.062l-.081 -.034l-.113 -.034l-.112 -.02l-.098 -.006z\" /></svg>`,\n                loader: `<div class=\"ai-chat-window-loader\">\r\n        <div></div>\r\n        <div></div>\r\n        <div></div>\r\n      </div>`,\n                inputPlaceholder: \"Type your message here...\",\n            },\n            assistantResponding: false,\n            markdown: false,\n            isOpen: () => {\n                const el = this.chatWindow.get();\n                if (!el) {\n                    return false;\n                }\n                return el.style.display === \"block\";\n            },\n            open: (identifier) => {\n                var _a;\n                this.console.log(\"Open chat window\");\n                const el = this.chatWindow.get();\n                if (!el) {\n                    return false;\n                }\n                // Check and set identifier\n                if (identifier && this.identifier !== identifier) {\n                    this.identifier = identifier;\n                }\n                this.chatWindow.set();\n                el.style.display = \"block\";\n                this.chatWindow.scrollToBottom();\n                (_a = this.chatWindow.messageInput.get()) === null || _a === void 0 ? void 0 : _a.focus();\n                return true;\n            },\n            close: () => {\n                var _a;\n                const el = this.chatWindow.get();\n                if (!el) {\n                    return false;\n                }\n                (_a = this.chatWindow.messageInput.get()) === null || _a === void 0 ? void 0 : _a.blur();\n                el.style.display = \"none\";\n                return true;\n            },\n            toggle: () => {\n                if (this.chatWindow.isOpen()) {\n                    return this.chatWindow.close();\n                }\n                else {\n                    return this.chatWindow.open();\n                }\n            },\n            get: () => {\n                if (this.chatWindow.id) {\n                    return document.getElementById(this.chatWindow.id);\n                }\n                return null;\n            },\n            set: () => {\n                var _a;\n                const el = this.chatWindow.get();\n                if (!el) {\n                    return false;\n                }\n                el.classList.add(\"ai-chat-window\");\n                el.innerHTML = `\r\n      <div class=\"ai-chat-window-container\">\r\n        <div class=\"ai-chat-window-header\">\r\n          <div class=\"ai-chat-window-header-left\">\r\n            ${this.chatWindow.defaults.logo}\r\n            <h2 class=\"ai-chat-window-title\" aria-label=\"Assistant\">Assistant</h2>\r\n          </div>\r\n          <div class=\"ai-chat-window-header-right\">\r\n            <button class=\"ai-chat-window-header-close\" aria-label=\"Close\">\r\n              ${this.chatWindow.defaults.closeIcon}\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <div class=\"ai-chat-window-messages\">\r\n          ${this.chatWindow.messages\n                    .map((message) => {\n                    const shouldRenderMarkdown = this.chatWindow.markdown &&\n                        this.showdown.converter &&\n                        message.sender === \"ASSISTANT\";\n                    const content = shouldRenderMarkdown\n                        ? this.showdown.converter.makeHtml(message.content)\n                        : message.content;\n                    this.console.log(\"content\", content);\n                    const messageStyle = shouldRenderMarkdown\n                        ? \"\"\n                        : \"white-space: pre-wrap\";\n                    return `\r\n          <div class=\"ai-chat-window-message ${`ai-chat-window-message-${message.sender.toLowerCase()}`}\">\r\n            ${message.sender === \"USER\" || message.sender === \"ASSISTANT\"\n                        ? `<div aria-label=\"${message.sender} ${message.content}\" style=\"${messageStyle}\">${content}${message.action\n                            ? this.actions[message.action]\n                                ? `<br/><button class=\"ai-chat-window-message-action\" aria-label=\"${message.action}\" data-ai-chat-window-message-action=\"${message.action}\">${message.action}</button>`\n                                : \"\"\n                            : \"\"} </div>`\n                        : message.sender === \"ASSISTANT-LOADING\"\n                            ? this.chatWindow.defaults.loader\n                            : `<p aria-label=\"${message.sender} ${message.content}\">${this.chatWindow.defaults.error}</p>`}   \r\n          </div>\r\n          `;\n                })\n                    .join(\"\")}\r\n        </div>\r\n        <div class=\"ai-chat-window-input-section\">\r\n          <form id=\"ai-chat-window-input-form\">\r\n            <div class=\"ai-chat-window-input-section-container\">\r\n              <textarea \r\n                type=\"text\" \r\n                class=\"ai-chat-window-input-field\"\r\n                name=\"message\"\r\n                aria-label=\"Type your message here...\"\r\n                placeholder=\"${this.chatWindow.defaults.inputPlaceholder}\"\r\n                ${this.chatWindow.assistantResponding ? `disabled=\"true\"` : \"\"} \r\n                rows=\"1\"\r\n                oninput=\"this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px';\"\r\n              ></textarea>\r\n              <button \r\n                class=\"ai-chat-window-input-send\"\r\n                aria-label=\"Send\"\r\n                type=\"submit\"\r\n              >\r\n                ${this.chatWindow.defaults.sendIcon}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>`;\n                this.chatWindow.eventListeners.add();\n                this.chatWindow.scrollToBottom();\n                (_a = this.chatWindow.messageInput.get()) === null || _a === void 0 ? void 0 : _a.focus();\n                return true;\n            },\n            addMessage: (messageData) => {\n                this.chatWindow.messages.push(messageData);\n            },\n            reset: () => {\n                this.chatWindow.messages = [];\n                this.chatWindow.set();\n            },\n            scrollToBottom: () => {\n                const el = this.chatWindow.messagesSection.get();\n                if (!el) {\n                    return null;\n                }\n                el.scrollTop = el.scrollHeight;\n            },\n            eventListeners: {\n                cleanup: () => {\n                    const el = this.chatWindow.get();\n                    if (!el) {\n                        return;\n                    }\n                    const closeButton = this.chatWindow.closeButton.get();\n                    if (closeButton) {\n                        closeButton.removeEventListener(\"click\", this.chatWindow.close);\n                    }\n                    const messageForm = this.chatWindow.messageForm.get();\n                    if (messageForm) {\n                        messageForm.removeEventListener(\"click\", this.chatWindow.messageForm.onsubmit);\n                    }\n                    const messageInput = this.chatWindow.messageInput.get();\n                    if (messageInput) {\n                        messageInput.removeEventListener(\"keydown\", this.chatWindow.messageInput.submitOnEnter);\n                    }\n                    const actionButtons = el.querySelectorAll(\"[data-ai-chat-window-message-action]\");\n                    if (actionButtons) {\n                        actionButtons.forEach((button) => {\n                            const actionName = button.getAttribute(\"data-ai-chat-window-message-action\");\n                            if (actionName && this.actions[actionName]) {\n                                button.removeEventListener(\"click\", () => {\n                                    this.actions[actionName]();\n                                });\n                            }\n                        });\n                    }\n                },\n                add: () => {\n                    const el = this.chatWindow.get();\n                    if (!el) {\n                        return null;\n                    }\n                    this.chatWindow.eventListeners.cleanup();\n                    const closeButton = this.chatWindow.closeButton.get();\n                    if (closeButton) {\n                        closeButton.addEventListener(\"click\", this.chatWindow.close);\n                    }\n                    const messageForm = this.chatWindow.messageForm.get();\n                    if (messageForm) {\n                        messageForm.addEventListener(\"submit\", this.chatWindow.messageForm.onsubmit);\n                    }\n                    const messageInput = this.chatWindow.messageInput.get();\n                    if (messageInput) {\n                        messageInput.addEventListener(\"keydown\", this.chatWindow.messageInput.submitOnEnter);\n                    }\n                    const actionButtons = el.querySelectorAll(\"[data-ai-chat-window-message-action]\");\n                    if (actionButtons) {\n                        actionButtons.forEach((button) => {\n                            const actionName = button.getAttribute(\"data-ai-chat-window-message-action\");\n                            if (actionName && this.actions[actionName]) {\n                                button.addEventListener(\"click\", () => {\n                                    this.actions[actionName]();\n                                });\n                            }\n                        });\n                    }\n                },\n            },\n            messagesSection: {\n                get: () => {\n                    const el = this.chatWindow.get();\n                    if (!el) {\n                        return null;\n                    }\n                    return el.querySelector(\".ai-chat-window-messages\");\n                },\n            },\n            closeButton: {\n                get: () => {\n                    const el = this.chatWindow.get();\n                    if (!el) {\n                        return null;\n                    }\n                    return el.querySelector(\".ai-chat-window-header-close\");\n                },\n            },\n            messageInput: {\n                get: () => {\n                    const el = this.chatWindow.get();\n                    if (!el) {\n                        return null;\n                    }\n                    return el.querySelector(\".ai-chat-window-input-field\");\n                },\n                submitOnEnter: (e) => {\n                    if (e.key === \"Enter\") {\n                        e.preventDefault();\n                        this.chatWindow.messageForm.onsubmit();\n                    }\n                },\n            },\n            messageForm: {\n                get: () => {\n                    const el = this.chatWindow.get();\n                    if (!el) {\n                        return null;\n                    }\n                    return el.querySelector(\"#ai-chat-window-input-form\");\n                },\n                onsubmit: () => {\n                    const el = this.chatWindow.messageForm.get();\n                    if (!el) {\n                        return null;\n                    }\n                    const input = this.chatWindow.messageInput.get();\n                    if (!input || !input.value.trim().length) {\n                        return null;\n                    }\n                    if (this.chatWindow.assistantResponding) {\n                        return null;\n                    }\n                    this.api.sendMessage.run(input.value);\n                },\n            },\n        };\n        this.api = {\n            sendMessage: {\n                run: (message) => __awaiter(this, void 0, void 0, function* () {\n                    if (!message) {\n                        throw new Error(\"Message is required\");\n                    }\n                    this.chatWindow.assistantResponding = true;\n                    this.chatWindow.addMessage({\n                        sender: \"USER\",\n                        content: message,\n                        new: false,\n                        createdAt: new Date(),\n                        action: null,\n                    });\n                    this.chatWindow.addMessage({\n                        sender: \"ASSISTANT-LOADING\",\n                        content: \"\",\n                        new: false,\n                        createdAt: new Date(),\n                        action: null,\n                    });\n                    this.chatWindow.set();\n                    const body = {\n                        message,\n                    };\n                    if (this.identifier) {\n                        body.identifier = this.identifier;\n                    }\n                    if (this.chatWindow.markdown && this.showdown.converter) {\n                        body.markdown = true;\n                    }\n                    const configuredActions = Object.keys(this.actions);\n                    if (configuredActions.length) {\n                        body.configuredActions = configuredActions;\n                    }\n                    const res = yield this.api.sendMessage.request(message, body);\n                    this.chatWindow.assistantResponding = false;\n                    this.chatWindow.messages.pop();\n                    if (!res || !res.data || !res.data.data) {\n                        this.console.error(\"Failed to send message.\");\n                        this.chatWindow.addMessage({\n                            sender: \"ERROR\",\n                            content: this.chatWindow.defaults.error,\n                            new: false,\n                            createdAt: new Date(),\n                            action: null,\n                        });\n                        this.chatWindow.set();\n                        return null;\n                    }\n                    const data = res.data;\n                    this.chatWindow.addMessage({\n                        sender: \"ASSISTANT\",\n                        content: data.data.assistantMessage,\n                        new: false,\n                        createdAt: new Date(),\n                        action: data.data.action,\n                    });\n                    this.chatWindow.set();\n                    if (data.data.identifier && this.identifier !== data.data.identifier) {\n                        this.identifier = data.data.identifier;\n                        this.localStorage.set(\"identifier\", this.identifier);\n                    }\n                    if (data.data.action &&\n                        this.actions[data.data.action] &&\n                        this.autoRunActions) {\n                        this.actions[data.data.action]();\n                    }\n                    return data.data;\n                }),\n                request: (message_1, ...args_1) => __awaiter(this, [message_1, ...args_1], void 0, function* (message, body = {}) {\n                    return yield this.request({\n                        method: this.api.sendMessage.method,\n                        url: this.api.sendMessage.url,\n                        body,\n                        signaturePayload: message,\n                    });\n                }),\n                method: \"POST\",\n                url: \"\",\n            },\n            getMessages: {\n                run: () => __awaiter(this, void 0, void 0, function* () {\n                    if (!this.identifier) {\n                        return [];\n                    }\n                    const res = yield this.api.getMessages.request(this.identifier);\n                    if (!res || !res.data || !res.data.data) {\n                        this.console.error(`Failed to get messages for identifier ${this.identifier}.`);\n                        return null;\n                    }\n                    const data = res.data;\n                    this.chatWindow.messages = data.data;\n                    this.chatWindow.set();\n                    return data.data;\n                }),\n                request: (identifier) => {\n                    return this.request({\n                        method: this.api.getMessages.method,\n                        url: `${this.api.getMessages.url}?identifier=${identifier}`,\n                        signaturePayload: identifier,\n                    });\n                },\n                method: \"GET\",\n                url: \"\",\n            },\n        };\n        this.autoRunActions = false;\n        this.actions = {};\n        this.arrayBufferToHex = (buffer) => __awaiter(this, void 0, void 0, function* () {\n            return new Promise((resolve) => {\n                const hex = Array.from(new Uint8Array(buffer))\n                    .map((byte) => byte.toString(16).padStart(2, \"0\"))\n                    .join(\"\");\n                resolve(hex);\n            });\n        });\n        this.generateSignature = (payload) => __awaiter(this, void 0, void 0, function* () {\n            if (!this.sharedSecretKeyConfig) {\n                this.console.error(\"sharedSecretKeyConfig is not set. Please set sharedSecretKeyConfig while initializing NavigableAI.\");\n                return null;\n            }\n            try {\n                const encoder = new TextEncoder();\n                const keyBuffer = encoder.encode(this.sharedSecretKeyConfig.sharedSecretKey);\n                const payloadBuffer = encoder.encode(payload);\n                const key = yield crypto.subtle.importKey(\"raw\", keyBuffer, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\"]);\n                const signature = yield crypto.subtle.sign(\"HMAC\", key, payloadBuffer);\n                return yield this.arrayBufferToHex(signature);\n            }\n            catch (error) {\n                this.console.error(\"Error generating signature:\", error);\n                return null;\n            }\n        });\n        this.request = (config) => __awaiter(this, void 0, void 0, function* () {\n            try {\n                let url = config.url;\n                const headers = Object.assign({ \"Content-Type\": \"application/json\" }, config.headers);\n                const body = Object.assign({}, config.body);\n                if (this.sharedSecretKeyConfig &&\n                    this.sharedSecretKeyConfig.sharedSecretKey &&\n                    this.sharedSecretKeyConfig.placement &&\n                    this.sharedSecretKeyConfig.key &&\n                    config.signaturePayload) {\n                    const signature = yield this.generateSignature(config.signaturePayload);\n                    if (!signature) {\n                        throw new Error(\"Failed to generate signature\");\n                    }\n                    if (this.sharedSecretKeyConfig.placement === \"query\") {\n                        url += `?${this.sharedSecretKeyConfig.key}=${signature}`;\n                    }\n                    else if (this.sharedSecretKeyConfig.placement === \"header\") {\n                        headers[this.sharedSecretKeyConfig.key] = signature;\n                    }\n                    else {\n                        throw new Error(`Invalid placement for shared secret key. Placement must be 'query', 'header', or 'body'. Found: ${this.sharedSecretKeyConfig.placement}`);\n                    }\n                }\n                const res = yield fetch(url, {\n                    method: config.method,\n                    headers,\n                    body: [\"OPTIONS\", \"HEAD\", \"GET\", \"DELETE\"].includes(config.method)\n                        ? undefined\n                        : JSON.stringify(body),\n                });\n                const data = yield res.json();\n                return Object.assign(Object.assign({}, res), { data });\n            }\n            catch (error) {\n                this.console.error(`Error in request: ${error}\\nConfig: ${config}`);\n                return null;\n            }\n        });\n        this.console = {\n            log: (...args) => {\n                console.log(\"NavigableAI:\", ...args);\n            },\n            error: (...args) => {\n                console.error(\"NavigableAI:\", ...args);\n            },\n        };\n        this.localStorage = {\n            set: (key, value) => {\n                localStorage.setItem(this.encoder.base64.encode(key), this.encoder.base64.encode(JSON.stringify(value)));\n            },\n            get: (key) => {\n                const value = localStorage.getItem(this.encoder.base64.encode(key));\n                if (!value) {\n                    return null;\n                }\n                return JSON.parse(this.encoder.base64.decode(value));\n            },\n        };\n        this.encoder = {\n            base64: {\n                encode: (str) => {\n                    return btoa(str);\n                },\n                decode: (str) => {\n                    return atob(str);\n                },\n            },\n        };\n        this.showdown = {\n            load: () => {\n                return new Promise((resolve, reject) => {\n                    const script = document.createElement(\"script\");\n                    script.src =\n                        \"https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js\";\n                    script.onload = () => {\n                        this.showdown.converter = new window.showdown.Converter();\n                        this.console.log(\"Showdown loaded. Converter: \", this.showdown.converter);\n                        resolve(window.showdown);\n                    };\n                    script.onerror = () => reject(new Error(\"Failed to load Showdown\"));\n                    document.head.appendChild(script);\n                });\n            },\n            converter: null,\n        };\n        if (!options.id) {\n            this.console.error(\"div with id is required\");\n            return;\n        }\n        const el = document.getElementById(options.id);\n        if (!el) {\n            this.console.error(\"div not found with id\", options.id);\n            return;\n        }\n        if (options.markdown) {\n            this.chatWindow.markdown = true;\n            this.showdown.load();\n        }\n        this.chatWindow.id = options.id;\n        if (options.sharedSecretKeyConfig) {\n            this.sharedSecretKeyConfig = options.sharedSecretKeyConfig;\n        }\n        if (options.apiConfig) {\n            if (options.apiConfig.sendMessage) {\n                this.api.sendMessage.url = options.apiConfig.sendMessage.url;\n                this.api.sendMessage.method = options.apiConfig.sendMessage.method;\n            }\n            if (options.apiConfig.getMessages) {\n                this.api.getMessages.url = options.apiConfig.getMessages.url;\n                this.api.getMessages.method = options.apiConfig.getMessages.method;\n            }\n        }\n        if (options.identifier) {\n            if (this.identifier !== options.identifier) {\n                this.setIdentifier(options.identifier);\n            }\n            else {\n                this.getIdentifierFromLocalStorage();\n            }\n        }\n        else {\n            this.getIdentifierFromLocalStorage();\n        }\n        if (this.identifier) {\n            this.api.getMessages.run();\n        }\n        if (options.actions) {\n            this.actions = options.actions;\n        }\n        if (options.autoRunActions) {\n            this.autoRunActions = options.autoRunActions;\n        }\n        if (options.defaults) {\n            if (options.defaults.error) {\n                this.chatWindow.defaults.error = options.defaults.error;\n            }\n            if (options.defaults.title) {\n                this.chatWindow.defaults.title = options.defaults.title;\n            }\n            if (options.defaults.inputPlaceholder) {\n                this.chatWindow.defaults.inputPlaceholder =\n                    options.defaults.inputPlaceholder;\n            }\n            if (options.defaults.logo) {\n                this.chatWindow.defaults.logo = options.defaults.logo;\n            }\n            if (options.defaults.closeIcon) {\n                this.chatWindow.defaults.closeIcon = options.defaults.closeIcon;\n            }\n            if (options.defaults.sendIcon) {\n                this.chatWindow.defaults.sendIcon = options.defaults.sendIcon;\n            }\n            if (options.defaults.loader) {\n                this.chatWindow.defaults.loader = options.defaults.loader;\n            }\n        }\n    }\n}\nexport { NavigableAI };\nif (typeof window !== \"undefined\") {\n    window.NavigableAI = NavigableAI;\n}\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","NavigableAI","constructor","options","this","sharedSecretKeyConfig","undefined","identifier","setIdentifier","localStorage","set","getIdentifierFromLocalStorage","get","chatWindow","id","messages","defaults","error","title","logo","closeIcon","sendIcon","loader","inputPlaceholder","assistantResponding","markdown","isOpen","el","style","display","open","_a","console","log","scrollToBottom","messageInput","focus","close","blur","toggle","document","getElementById","classList","add","innerHTML","map","message","shouldRenderMarkdown","showdown","converter","sender","content","makeHtml","messageStyle","toLowerCase","action","actions","join","eventListeners","addMessage","messageData","push","reset","messagesSection","scrollTop","scrollHeight","cleanup","closeButton","removeEventListener","messageForm","onsubmit","submitOnEnter","actionButtons","querySelectorAll","forEach","button","actionName","getAttribute","addEventListener","querySelector","key","preventDefault","input","trim","length","api","sendMessage","run","Error","new","createdAt","Date","body","configuredActions","Object","keys","res","request","pop","data","assistantMessage","autoRunActions","message_1","args_1","method","url","signaturePayload","getMessages","arrayBufferToHex","buffer","Array","from","Uint8Array","byte","toString","padStart","generateSignature","payload","encoder","TextEncoder","keyBuffer","encode","sharedSecretKey","payloadBuffer","crypto","subtle","importKey","name","hash","signature","sign","config","headers","assign","placement","fetch","includes","JSON","stringify","json","args","setItem","base64","getItem","parse","decode","str","btoa","atob","load","script","createElement","src","onload","window","Converter","onerror","head","appendChild","apiConfig"],"mappings":"mPAAA,IAAIA,EAAwC,SAAUC,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,GAAQ,CAAG,MAAOG,GAAKL,EAAOK,GAAO,CAC3F,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,GAAU,CAAC,MAAOG,GAAKL,EAAOK,GAAO,CAC9F,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,EAAO,KAIhBO,KAAKR,EAAWK,EAAY,CAC9GH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,OACtE,GACA,EACA,MAAMO,EACF,WAAAC,CAAYC,GA8fR,GA7fAC,KAAKC,2BAAwBC,EAC7BF,KAAKG,gBAAaD,EAClBF,KAAKI,cAAiBD,IAClBH,KAAKG,WAAaA,EAClBH,KAAKK,aAAaC,IAAI,aAAcH,EAAW,EAEnDH,KAAKO,8BAAgC,KACjC,MAAMJ,EAAaH,KAAKK,aAAaG,IAAI,cACrCL,IACAH,KAAKG,WAAaA,EACrB,EAELH,KAAKS,WAAa,CACdC,QAAIR,EACJS,SAAU,GACVC,SAAU,CACNC,MAAO,6CACPC,MAAO,YACPC,KAAM,0kBACNC,UAAW,+YACXC,SAAU,orBACVC,OAAQ,mHAKRC,iBAAkB,6BAEtBC,qBAAqB,EACrBC,UAAU,EACVC,OAAQ,KACJ,MAAMC,EAAKvB,KAAKS,WAAWD,MAC3B,QAAKe,GAGuB,UAArBA,EAAGC,MAAMC,OAAmB,EAEvCC,KAAOvB,IACH,IAAIwB,EACJ3B,KAAK4B,QAAQC,IAAI,oBACjB,MAAMN,EAAKvB,KAAKS,WAAWD,MAC3B,QAAKe,IAIDpB,GAAcH,KAAKG,aAAeA,IAClCH,KAAKG,WAAaA,GAEtBH,KAAKS,WAAWH,MAChBiB,EAAGC,MAAMC,QAAU,QACnBzB,KAAKS,WAAWqB,iBAC8B,QAA7CH,EAAK3B,KAAKS,WAAWsB,aAAavB,aAA0B,IAAPmB,GAAyBA,EAAGK,SAC3E,EAAI,EAEfC,MAAO,KACH,IAAIN,EACJ,MAAMJ,EAAKvB,KAAKS,WAAWD,MAC3B,QAAKe,IAGyC,QAA7CI,EAAK3B,KAAKS,WAAWsB,aAAavB,aAA0B,IAAPmB,GAAyBA,EAAGO,OAClFX,EAAGC,MAAMC,QAAU,QACZ,EAAI,EAEfU,OAAQ,IACAnC,KAAKS,WAAWa,SACTtB,KAAKS,WAAWwB,QAGhBjC,KAAKS,WAAWiB,OAG/BlB,IAAK,IACGR,KAAKS,WAAWC,GACT0B,SAASC,eAAerC,KAAKS,WAAWC,IAE5C,KAEXJ,IAAK,KACD,IAAIqB,EACJ,MAAMJ,EAAKvB,KAAKS,WAAWD,MAC3B,QAAKe,IAGLA,EAAGe,UAAUC,IAAI,kBACjBhB,EAAGiB,UAAY,gKAIjBxC,KAAKS,WAAWG,SAASG,+PAKvBf,KAAKS,WAAWG,SAASI,gIAK7BhB,KAAKS,WAAWE,SACP8B,KAAKC,IACN,MAAMC,EAAuB3C,KAAKS,WAAWY,UACzCrB,KAAK4C,SAASC,WACK,cAAnBH,EAAQI,OACNC,EAAUJ,EACV3C,KAAK4C,SAASC,UAAUG,SAASN,EAAQK,SACzCL,EAAQK,QACd/C,KAAK4B,QAAQC,IAAI,UAAWkB,GAC5B,MAAME,EAAeN,EACf,GACA,wBACN,MAAO,yEAC8CD,EAAQI,OAAOI,gCACvD,SAAnBR,EAAQI,QAAwC,cAAnBJ,EAAQI,OACzB,oBAAoBJ,EAAQI,UAAUJ,EAAQK,mBAAmBE,MAAiBF,IAAUL,EAAQS,QAChGnD,KAAKoD,QAAQV,EAAQS,QACjB,kEAAkET,EAAQS,+CAA+CT,EAAQS,WAAWT,EAAQS,kBAExJ,YACe,sBAAnBT,EAAQI,OACJ9C,KAAKS,WAAWG,SAASM,OACzB,kBAAkBwB,EAAQI,UAAUJ,EAAQK,YAAY/C,KAAKS,WAAWG,SAASC,8CAEpG,IAEUwC,KAAK,gaAUKrD,KAAKS,WAAWG,SAASO,sCACtCnB,KAAKS,WAAWW,oBAAsB,kBAAoB,iVAS1DpB,KAAKS,WAAWG,SAASK,yGAM3BjB,KAAKS,WAAW6C,eAAef,MAC/BvC,KAAKS,WAAWqB,iBAC8B,QAA7CH,EAAK3B,KAAKS,WAAWsB,aAAavB,aAA0B,IAAPmB,GAAyBA,EAAGK,SAC3E,EAAI,EAEfuB,WAAaC,IACTxD,KAAKS,WAAWE,SAAS8C,KAAKD,EAAY,EAE9CE,MAAO,KACH1D,KAAKS,WAAWE,SAAW,GAC3BX,KAAKS,WAAWH,KAAK,EAEzBwB,eAAgB,KACZ,MAAMP,EAAKvB,KAAKS,WAAWkD,gBAAgBnD,MAC3C,IAAKe,EACD,OAAO,KAEXA,EAAGqC,UAAYrC,EAAGsC,YAAY,EAElCP,eAAgB,CACZQ,QAAS,KACL,MAAMvC,EAAKvB,KAAKS,WAAWD,MAC3B,IAAKe,EACD,OAEJ,MAAMwC,EAAc/D,KAAKS,WAAWsD,YAAYvD,MAC5CuD,GACAA,EAAYC,oBAAoB,QAAShE,KAAKS,WAAWwB,OAE7D,MAAMgC,EAAcjE,KAAKS,WAAWwD,YAAYzD,MAC5CyD,GACAA,EAAYD,oBAAoB,QAAShE,KAAKS,WAAWwD,YAAYC,UAEzE,MAAMnC,EAAe/B,KAAKS,WAAWsB,aAAavB,MAC9CuB,GACAA,EAAaiC,oBAAoB,UAAWhE,KAAKS,WAAWsB,aAAaoC,eAE7E,MAAMC,EAAgB7C,EAAG8C,iBAAiB,wCACtCD,GACAA,EAAcE,SAASC,IACnB,MAAMC,EAAaD,EAAOE,aAAa,sCACnCD,GAAcxE,KAAKoD,QAAQoB,IAC3BD,EAAOP,oBAAoB,SAAS,KAChChE,KAAKoD,QAAQoB,IAAa,GAEjC,GAER,EAELjC,IAAK,KACD,MAAMhB,EAAKvB,KAAKS,WAAWD,MAC3B,IAAKe,EACD,OAAO,KAEXvB,KAAKS,WAAW6C,eAAeQ,UAC/B,MAAMC,EAAc/D,KAAKS,WAAWsD,YAAYvD,MAC5CuD,GACAA,EAAYW,iBAAiB,QAAS1E,KAAKS,WAAWwB,OAE1D,MAAMgC,EAAcjE,KAAKS,WAAWwD,YAAYzD,MAC5CyD,GACAA,EAAYS,iBAAiB,SAAU1E,KAAKS,WAAWwD,YAAYC,UAEvE,MAAMnC,EAAe/B,KAAKS,WAAWsB,aAAavB,MAC9CuB,GACAA,EAAa2C,iBAAiB,UAAW1E,KAAKS,WAAWsB,aAAaoC,eAE1E,MAAMC,EAAgB7C,EAAG8C,iBAAiB,wCACtCD,GACAA,EAAcE,SAASC,IACnB,MAAMC,EAAaD,EAAOE,aAAa,sCACnCD,GAAcxE,KAAKoD,QAAQoB,IAC3BD,EAAOG,iBAAiB,SAAS,KAC7B1E,KAAKoD,QAAQoB,IAAa,GAEjC,GAER,GAGTb,gBAAiB,CACbnD,IAAK,KACD,MAAMe,EAAKvB,KAAKS,WAAWD,MAC3B,OAAKe,EAGEA,EAAGoD,cAAc,4BAFb,IAEwC,GAG3DZ,YAAa,CACTvD,IAAK,KACD,MAAMe,EAAKvB,KAAKS,WAAWD,MAC3B,OAAKe,EAGEA,EAAGoD,cAAc,gCAFb,IAE4C,GAG/D5C,aAAc,CACVvB,IAAK,KACD,MAAMe,EAAKvB,KAAKS,WAAWD,MAC3B,OAAKe,EAGEA,EAAGoD,cAAc,+BAFb,IAE2C,EAE1DR,cAAgB5E,IACE,UAAVA,EAAEqF,MACFrF,EAAEsF,iBACF7E,KAAKS,WAAWwD,YAAYC,WAC/B,GAGTD,YAAa,CACTzD,IAAK,KACD,MAAMe,EAAKvB,KAAKS,WAAWD,MAC3B,OAAKe,EAGEA,EAAGoD,cAAc,8BAFb,IAE0C,EAEzDT,SAAU,KAEN,IADWlE,KAAKS,WAAWwD,YAAYzD,MAEnC,OAAO,KAEX,MAAMsE,EAAQ9E,KAAKS,WAAWsB,aAAavB,MAC3C,OAAKsE,GAAUA,EAAM1F,MAAM2F,OAAOC,OAG9BhF,KAAKS,WAAWW,oBACT,UAEXpB,KAAKiF,IAAIC,YAAYC,IAAIL,EAAM1F,OALpB,IAK0B,IAIjDY,KAAKiF,IAAM,CACPC,YAAa,CACTC,IAAMzC,GAAY/D,EAAUqB,UAAM,OAAQ,GAAQ,YAC9C,IAAK0C,EACD,MAAM,IAAI0C,MAAM,uBAEpBpF,KAAKS,WAAWW,qBAAsB,EACtCpB,KAAKS,WAAW8C,WAAW,CACvBT,OAAQ,OACRC,QAASL,EACT2C,KAAK,EACLC,UAAW,IAAIC,KACfpC,OAAQ,OAEZnD,KAAKS,WAAW8C,WAAW,CACvBT,OAAQ,oBACRC,QAAS,GACTsC,KAAK,EACLC,UAAW,IAAIC,KACfpC,OAAQ,OAEZnD,KAAKS,WAAWH,MAChB,MAAMkF,EAAO,CACT9C,WAEA1C,KAAKG,aACLqF,EAAKrF,WAAaH,KAAKG,YAEvBH,KAAKS,WAAWY,UAAYrB,KAAK4C,SAASC,YAC1C2C,EAAKnE,UAAW,GAEpB,MAAMoE,EAAoBC,OAAOC,KAAK3F,KAAKoD,SACvCqC,EAAkBT,SAClBQ,EAAKC,kBAAoBA,GAE7B,MAAMG,QAAY5F,KAAKiF,IAAIC,YAAYW,QAAQnD,EAAS8C,GAGxD,GAFAxF,KAAKS,WAAWW,qBAAsB,EACtCpB,KAAKS,WAAWE,SAASmF,OACpBF,IAAQA,EAAIG,OAASH,EAAIG,KAAKA,KAU/B,OATA/F,KAAK4B,QAAQf,MAAM,2BACnBb,KAAKS,WAAW8C,WAAW,CACvBT,OAAQ,QACRC,QAAS/C,KAAKS,WAAWG,SAASC,MAClCwE,KAAK,EACLC,UAAW,IAAIC,KACfpC,OAAQ,OAEZnD,KAAKS,WAAWH,MACT,KAEX,MAAMyF,EAAOH,EAAIG,KAkBjB,OAjBA/F,KAAKS,WAAW8C,WAAW,CACvBT,OAAQ,YACRC,QAASgD,EAAKA,KAAKC,iBACnBX,KAAK,EACLC,UAAW,IAAIC,KACfpC,OAAQ4C,EAAKA,KAAK5C,SAEtBnD,KAAKS,WAAWH,MACZyF,EAAKA,KAAK5F,YAAcH,KAAKG,aAAe4F,EAAKA,KAAK5F,aACtDH,KAAKG,WAAa4F,EAAKA,KAAK5F,WAC5BH,KAAKK,aAAaC,IAAI,aAAcN,KAAKG,aAEzC4F,EAAKA,KAAK5C,QACVnD,KAAKoD,QAAQ2C,EAAKA,KAAK5C,SACvBnD,KAAKiG,gBACLjG,KAAKoD,QAAQ2C,EAAKA,KAAK5C,UAEpB4C,EAAKA,IAChC,IACgBF,QAAS,CAACK,KAAcC,IAAWxH,EAAUqB,KAAM,CAACkG,KAAcC,QAAS,GAAQ,UAAWzD,EAAS8C,EAAO,CAAA,GAC1G,aAAaxF,KAAK6F,QAAQ,CACtBO,OAAQpG,KAAKiF,IAAIC,YAAYkB,OAC7BC,IAAKrG,KAAKiF,IAAIC,YAAYmB,IAC1Bb,OACAc,iBAAkB5D,GAE1C,IACgB0D,OAAQ,OACRC,IAAK,IAETE,YAAa,CACTpB,IAAK,IAAMxG,EAAUqB,UAAM,OAAQ,GAAQ,YACvC,IAAKA,KAAKG,WACN,MAAO,GAEX,MAAMyF,QAAY5F,KAAKiF,IAAIsB,YAAYV,QAAQ7F,KAAKG,YACpD,IAAKyF,IAAQA,EAAIG,OAASH,EAAIG,KAAKA,KAE/B,OADA/F,KAAK4B,QAAQf,MAAM,yCAAyCb,KAAKG,eAC1D,KAEX,MAAM4F,EAAOH,EAAIG,KAGjB,OAFA/F,KAAKS,WAAWE,SAAWoF,EAAKA,KAChC/F,KAAKS,WAAWH,MACTyF,EAAKA,IAChC,IACgBF,QAAU1F,GACCH,KAAK6F,QAAQ,CAChBO,OAAQpG,KAAKiF,IAAIsB,YAAYH,OAC7BC,IAAK,GAAGrG,KAAKiF,IAAIsB,YAAYF,kBAAkBlG,IAC/CmG,iBAAkBnG,IAG1BiG,OAAQ,MACRC,IAAK,KAGbrG,KAAKiG,gBAAiB,EACtBjG,KAAKoD,QAAU,GACfpD,KAAKwG,iBAAoBC,GAAW9H,EAAUqB,UAAM,OAAQ,GAAQ,YAChE,OAAO,IAAIhB,SAASC,IAIhBA,EAHYyH,MAAMC,KAAK,IAAIC,WAAWH,IACjChE,KAAKoE,GAASA,EAAKC,SAAS,IAAIC,SAAS,EAAG,OAC5C1D,KAAK,IACE,GAE5B,IACQrD,KAAKgH,kBAAqBC,GAAYtI,EAAUqB,UAAM,OAAQ,GAAQ,YAClE,IAAKA,KAAKC,sBAEN,OADAD,KAAK4B,QAAQf,MAAM,sGACZ,KAEX,IACI,MAAMqG,EAAU,IAAIC,YACdC,EAAYF,EAAQG,OAAOrH,KAAKC,sBAAsBqH,iBACtDC,EAAgBL,EAAQG,OAAOJ,GAC/BrC,QAAY4C,OAAOC,OAAOC,UAAU,MAAON,EAAW,CAAEO,KAAM,OAAQC,KAAM,YAAa,EAAO,CAAC,SACjGC,QAAkBL,OAAOC,OAAOK,KAAK,OAAQlD,EAAK2C,GACxD,aAAavH,KAAKwG,iBAAiBqB,EACtC,CACD,MAAOhH,GAEH,OADAb,KAAK4B,QAAQf,MAAM,8BAA+BA,GAC3C,IACV,CACb,IACQb,KAAK6F,QAAWkC,GAAWpJ,EAAUqB,UAAM,OAAQ,GAAQ,YACvD,IACI,IAAIqG,EAAM0B,EAAO1B,IACjB,MAAM2B,EAAUtC,OAAOuC,OAAO,CAAE,eAAgB,oBAAsBF,EAAOC,SACvExC,EAAOE,OAAOuC,OAAO,CAAA,EAAIF,EAAOvC,MACtC,GAAIxF,KAAKC,uBACLD,KAAKC,sBAAsBqH,iBAC3BtH,KAAKC,sBAAsBiI,WAC3BlI,KAAKC,sBAAsB2E,KAC3BmD,EAAOzB,iBAAkB,CACzB,MAAMuB,QAAkB7H,KAAKgH,kBAAkBe,EAAOzB,kBACtD,IAAKuB,EACD,MAAM,IAAIzC,MAAM,gCAEpB,GAA6C,UAAzCpF,KAAKC,sBAAsBiI,UAC3B7B,GAAO,IAAIrG,KAAKC,sBAAsB2E,OAAOiD,QAE5C,IAA6C,WAAzC7H,KAAKC,sBAAsBiI,UAIhC,MAAM,IAAI9C,MAAM,mGAAmGpF,KAAKC,sBAAsBiI,aAH9IF,EAAQhI,KAAKC,sBAAsB2E,KAAOiD,CAI7C,CACJ,CACD,MAAMjC,QAAYuC,MAAM9B,EAAK,CACzBD,OAAQ2B,EAAO3B,OACf4B,UACAxC,KAAM,CAAC,UAAW,OAAQ,MAAO,UAAU4C,SAASL,EAAO3B,aACrDlG,EACAmI,KAAKC,UAAU9C,KAEnBO,QAAaH,EAAI2C,OACvB,OAAO7C,OAAOuC,OAAOvC,OAAOuC,OAAO,CAAE,EAAErC,GAAM,CAAEG,QAClD,CACD,MAAOlF,GAEH,OADAb,KAAK4B,QAAQf,MAAM,qBAAqBA,cAAkBkH,KACnD,IACV,CACb,IACQ/H,KAAK4B,QAAU,CACXC,IAAK,IAAI2G,KACL5G,QAAQC,IAAI,kBAAmB2G,EAAK,EAExC3H,MAAO,IAAI2H,KACP5G,QAAQf,MAAM,kBAAmB2H,EAAK,GAG9CxI,KAAKK,aAAe,CAChBC,IAAK,CAACsE,EAAKxF,KACPiB,aAAaoI,QAAQzI,KAAKkH,QAAQwB,OAAOrB,OAAOzC,GAAM5E,KAAKkH,QAAQwB,OAAOrB,OAAOgB,KAAKC,UAAUlJ,IAAQ,EAE5GoB,IAAMoE,IACF,MAAMxF,EAAQiB,aAAasI,QAAQ3I,KAAKkH,QAAQwB,OAAOrB,OAAOzC,IAC9D,OAAKxF,EAGEiJ,KAAKO,MAAM5I,KAAKkH,QAAQwB,OAAOG,OAAOzJ,IAFlC,IAEyC,GAG5DY,KAAKkH,QAAU,CACXwB,OAAQ,CACJrB,OAASyB,GACEC,KAAKD,GAEhBD,OAASC,GACEE,KAAKF,KAIxB9I,KAAK4C,SAAW,CACZqG,KAAM,IACK,IAAIjK,SAAQ,CAACC,EAASC,KACzB,MAAMgK,EAAS9G,SAAS+G,cAAc,UACtCD,EAAOE,IACH,wEACJF,EAAOG,OAAS,KACZrJ,KAAK4C,SAASC,UAAY,IAAIyG,OAAO1G,SAAS2G,UAC9CvJ,KAAK4B,QAAQC,IAAI,+BAAgC7B,KAAK4C,SAASC,WAC/D5D,EAAQqK,OAAO1G,SAAS,EAE5BsG,EAAOM,QAAU,IAAMtK,EAAO,IAAIkG,MAAM,4BACxChD,SAASqH,KAAKC,YAAYR,EAAO,IAGzCrG,UAAW,OAEV9C,EAAQW,GAET,YADAV,KAAK4B,QAAQf,MAAM,2BAGZuB,SAASC,eAAetC,EAAQW,KAKvCX,EAAQsB,WACRrB,KAAKS,WAAWY,UAAW,EAC3BrB,KAAK4C,SAASqG,QAElBjJ,KAAKS,WAAWC,GAAKX,EAAQW,GACzBX,EAAQE,wBACRD,KAAKC,sBAAwBF,EAAQE,uBAErCF,EAAQ4J,YACJ5J,EAAQ4J,UAAUzE,cAClBlF,KAAKiF,IAAIC,YAAYmB,IAAMtG,EAAQ4J,UAAUzE,YAAYmB,IACzDrG,KAAKiF,IAAIC,YAAYkB,OAASrG,EAAQ4J,UAAUzE,YAAYkB,QAE5DrG,EAAQ4J,UAAUpD,cAClBvG,KAAKiF,IAAIsB,YAAYF,IAAMtG,EAAQ4J,UAAUpD,YAAYF,IACzDrG,KAAKiF,IAAIsB,YAAYH,OAASrG,EAAQ4J,UAAUpD,YAAYH,SAGhErG,EAAQI,YACJH,KAAKG,aAAeJ,EAAQI,WAC5BH,KAAKI,cAAcL,EAAQI,YAO/BH,KAAKO,gCAELP,KAAKG,YACLH,KAAKiF,IAAIsB,YAAYpB,MAErBpF,EAAQqD,UACRpD,KAAKoD,QAAUrD,EAAQqD,SAEvBrD,EAAQkG,iBACRjG,KAAKiG,eAAiBlG,EAAQkG,gBAE9BlG,EAAQa,WACJb,EAAQa,SAASC,QACjBb,KAAKS,WAAWG,SAASC,MAAQd,EAAQa,SAASC,OAElDd,EAAQa,SAASE,QACjBd,KAAKS,WAAWG,SAASE,MAAQf,EAAQa,SAASE,OAElDf,EAAQa,SAASO,mBACjBnB,KAAKS,WAAWG,SAASO,iBACrBpB,EAAQa,SAASO,kBAErBpB,EAAQa,SAASG,OACjBf,KAAKS,WAAWG,SAASG,KAAOhB,EAAQa,SAASG,MAEjDhB,EAAQa,SAASI,YACjBhB,KAAKS,WAAWG,SAASI,UAAYjB,EAAQa,SAASI,WAEtDjB,EAAQa,SAASK,WACjBjB,KAAKS,WAAWG,SAASK,SAAWlB,EAAQa,SAASK,UAErDlB,EAAQa,SAASM,SACjBlB,KAAKS,WAAWG,SAASM,OAASnB,EAAQa,SAASM,UA9DvDlB,KAAK4B,QAAQf,MAAM,wBAAyBd,EAAQW,GAiE3D,EAGiB,oBAAX4I,SACPA,OAAOzJ,YAAcA"}